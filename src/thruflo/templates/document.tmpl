<%inherit file="context.tmpl"/>

<%def name="render_tree(data, master=False)">
  % for folder_name, items in data.get('fs').items():
    <li class="${master and 'open' or 'closed'}">
      <span class="folder">${folder_name}</span>
      % if items.has_key('fs'):
        <ul>
          ${self.render_tree(items)}
        </ul>
      % endif
    </li>
  % endfor
  % for file_name, github_hash in data.get('f').items():
    <li id="${github_hash}" class="file ui-draggable">
      <span class="file">${file_name}</span>
    </li>
  % endfor
</%def>

<%def name="manage()">
  <div id="zoom-bar">
    zoom
  </div>
  <div id="inspector">
    <div id="repository-browser" class="accordion filetree">
      % for repository in handler.repositories:
        <h3>
          <a href="#">${repository.name}</a>
        </h3>
        <div class="accordion">
          <%
            branches = []
            for item in repository.branches:
                branches.append(item)
            branches = sorted(branches)
            if 'master' in branches:
                branches.remove('master')
                branches.insert(0, 'master')

          %>
          % for branch_name in branches:
            <h3>
              <a href="#">${branch_name}</a>
            </h3>
            <div>
              <ul>
                <%
                  blob_tree = repository.blob_tree.get(branch_name, None)
                %>
                % if blob_tree:
                  ${self.render_tree(blob_tree, master=bool(branch_name=='master'))}
                % endif
              </ul>
            </div>
          % endfor
        </div>
      % endfor
    </div>
  </div>
  <div id="sections-container" class="ui-droppable">
    % for source in handler.context.sources:
      source
    % endfor
  </div>
</%def>